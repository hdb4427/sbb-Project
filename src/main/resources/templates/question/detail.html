<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/layout}">

<th:block layout:fragment="css">
    <style>
        /* ì¹´í…Œê³ ë¦¬ & íƒ€ì´í‹€ */
        .blog-category {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .blog-subject {
            font-size: 1.8rem;
            font-weight: bold;
            color: #000;
            margin-bottom: 15px;
        }

        /* ì‘ì„±ì í”„ë¡œí•„ ì˜ì—­ (êµ¬ë¶„ì„  ìˆìŒ) */
        .blog-meta {
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .blog-author-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            border: 1px solid #eee;
        }
        .blog-info {
            font-size: 0.9rem;
        }
        .blog-author-name {
            font-weight: bold;
            color: #333;
        }
        .blog-date {
            color: #888;
            font-size: 0.8rem;
        }

        /* ë³¸ë¬¸ ì˜ì—­ (ë°°ê²½ìƒ‰ ìˆìŒ, ê·¸ë¦¼ì ì—†ìŒ) */
        .blog-content-box {
            background-color: #fcfcfc; /* ì•„ì£¼ ì—°í•œ íšŒìƒ‰ */
            padding: 40px;
            border-radius: 15px;
            font-size: 1.05rem;
            line-height: 1.8;
            color: #333;
            min-height: 200px;
            margin-bottom: 50px;
            border: 1px solid #f1f1f1; /* í…Œë‘ë¦¬ ì•„ì£¼ ì‚´ì§ */
        }
        .blog-content-box img {
            max-width: 100%;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* ëŒ“ê¸€ ì˜ì—­ (ë°°ê²½ìƒ‰ ìˆìŒ, ê·¸ë¦¼ì ì—†ìŒ) */
        .comment-section {
            background-color: #f8f9fa; /* ëŒ“ê¸€ ì˜ì—­ ë°°ê²½ */
            padding: 30px;
            border-radius: 15px;
        }
        .comment-header {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .comment-item {
            display: flex;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .comment-item:last-child { border-bottom: none; }

        .comment-img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }
        .comment-body {
            flex-grow: 1;
        }
        .comment-author {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }
        .comment-text {
            font-size: 0.95rem;
            color: #444;
            white-space: pre-line;
            margin-bottom: 5px;
        }
        .comment-date {
            font-size: 0.75rem;
            color: #999;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì‹¬í”Œí•œ í…ìŠ¤íŠ¸ ë§í¬ë¡œ ë³µê·€) */
        .btn-text {
            text-decoration: none;
            color: #777;
            font-size: 0.85rem;
            margin-left: 10px;
            cursor: pointer;
        }
        .btn-text:hover { color: #333; text-decoration: underline; }
        .text-danger:hover { color: #ff0000 !important; }
    </style>
</th:block>

<div layout:fragment="content" class="container my-4" style="max-width: 900px;">

    <div class="mb-3">
        <div class="blog-category">
            <span class="text-primary" th:if="${question.category == 'ìš´ë™'}">ğŸ‹ï¸ í—¬ìŠ¤</span>
            <span class="text-success" th:if="${question.category == 'ì‹ë‹¨'}">ğŸ¥— ì‹ë‹¨</span>
            <span class="text-info" th:if="${question.category == 'ëˆˆë°”ë””'}">ğŸ‘€ ëˆˆë°”ë””</span>
            <span class="text-secondary" th:if="${question.category == 'ììœ '}">ğŸ—£ï¸ ììœ </span>
        </div>

        <h1 class="blog-subject" th:text="${question.subject}">ì œëª©ì…ë‹ˆë‹¤.</h1>

        <div class="blog-meta">
            <img th:src="${question.author?.profileImage ?: '/images/default.png'}"
                 class="blog-author-img" alt="í”„ë¡œí•„">

            <div class="blog-info">
                <div class="blog-author-name" th:text="${question.author?.username}">ì‘ì„±ì</div>
                <div class="blog-date">
                    <span th:text="${#temporals.format(question.created, 'yyyy.MM.dd. HH:mm')}"></span>
                </div>
            </div>

            <div class="ms-auto"
                 sec:authorize="isAuthenticated()"
                 th:if="${question.author != null and #authentication.getPrincipal().getUsername() == question.author.username}">
                <a th:href="@{|/question/modify/${question.id}|}" class="btn-text">ìˆ˜ì •</a>
                <a href="javascript:void(0);"
                   th:data-uri="@{|/question/delete/${question.id}|}"
                   class="delete btn-text text-danger">ì‚­ì œ</a>
            </div>
        </div>
    </div>

    <div class="blog-content-box">
        <div th:if="${question.thumbnail != null}" class="text-center">
            <img th:src="@{${question.thumbnail}}" alt="ì²¨ë¶€ ì´ë¯¸ì§€">
        </div>

        <div th:text="${question.content}">ë‚´ìš©</div>
    </div>

    <div class="comment-section">
        <div class="comment-header">
            ëŒ“ê¸€ <span class="text-success" th:text="${#lists.size(question.answerList)}">0</span>
        </div>

        <div class="comment-list">
            <div th:each="answer : ${question.answerList}" class="comment-item">
                <img th:src="${answer.author?.profileImage ?: '/images/default.png'}"
                     class="comment-img" alt="í”„ì‚¬">

                <div class="comment-body">
                    <div class="d-flex justify-content-between">
                        <span class="comment-author" th:text="${answer.author?.username}">ì‘ì„±ì</span>

                        <div sec:authorize="isAuthenticated()"
                             th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}">
                            <a th:href="@{|/answer/modify/${answer.id}|}" class="btn-text" style="font-size: 0.8rem;">ìˆ˜ì •</a>
                            <a href="javascript:void(0);"
                               th:data-uri="@{|/answer/delete/${answer.id}|}"
                               class="delete btn-text text-danger" style="font-size: 0.8rem;">ì‚­ì œ</a>
                        </div>
                    </div>

                    <div class="comment-text" th:text="${answer.content}">ëŒ“ê¸€ ë‚´ìš©</div>

                    <div class="comment-date">
                        <span th:text="${#temporals.format(answer.created, 'yyyy.MM.dd. HH:mm')}"></span>
                        <span th:if="${answer.updated != null}">(ìˆ˜ì •ë¨)</span>
                    </div>
                </div>
            </div>
        </div>

        <form th:action="@{|/answer/create/${question.id}|}" method="post" class="mt-4" th:object="${answerDto}">
            <textarea sec:authorize="isAnonymous()" disabled
                      th:field="*{content}"
                      rows="3" class="form-control" placeholder="ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."></textarea>

            <textarea sec:authorize="isAuthenticated()"
                      th:field="*{content}"
                      rows="3" class="form-control" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>

            <div class="d-flex justify-content-between align-items-center mt-2">
                <p th:if="${#fields.hasErrors('content')}" th:errors="*{content}" class="fieldError mb-0">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”</p>
                <div th:unless="${#fields.hasErrors('content')}"></div>
                <button type="submit" class="btn btn-dark btn-sm px-4">ë“±ë¡</button>
            </div>
        </form>
    </div>
</div>

<th:block layout:fragment="script">
    <script type="text/javascript">
        $(document).ready(function () {
            // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            $('.delete').click(function () {
                if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    const uri = $(this).data('uri');
                    window.location.href = uri;
                }
            });
        });
    </script>
</th:block>
</html>